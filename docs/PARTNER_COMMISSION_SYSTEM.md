# 파트너 동적 목표 및 수익 분배 시스템 문서

## 개요

파트너 시스템이 **고정된 목표의 한계를 극복**하고 **성장성과 유연성을 확보**하기 위해 새로운 동적 목표 시스템으로 전면 개편되었습니다.

### 핵심 개선 사항
- ❌ **기존**: 파트너 타입에서 고정된 목표 + 수수료 관리
- ✅ **개선**: 파트너 타입 = 최소 기준치, 파트너 등급 = 승수 계산, 동적 목표 = 개인별 맞춤 관리

## 새로운 시스템 아키텍처

### 1. **3단계 분리된 역할 구조**

#### 🔵 **Partner Types** (파트너 타입) - **최소 기준치 관리**
```
역할: 각 파트너 유형별 최소한의 성과 기준 제시
목적: 동적 목표 계산의 기반이 되는 베이스라인
```

#### 🟡 **Partner Tiers** (파트너 등급) - **승수 시스템**
```
역할: 등급별 목표 확대를 위한 승수 적용
목적: 타입별 최소 기준치에 등급별 승수를 곱하여 개인별 기본 목표 산출
```

#### 🟢 **Partner Dynamic Targets** (동적 목표) - **개인별 맞춤 관리**
```
역할: 월별/분기별/연별 개인화된 목표 설정 및 성과 추적
목적: 유연한 목표 조정과 성과 기반 보너스 관리
```

---

## 📊 Partner Types (파트너 타입) - 최소 기준치 시스템

### 🎯 **역할 변경: 수수료 관리 → 최소 기준치 제공**

**Before (기존):**
- `commission_bonus_rate`: 타입별 수수료율 관리 ❌ **제거됨**
- `target_sales_amount`: 고정된 목표값

**After (개선):**
- **수수료 관리 완전 제거** - 동적 목표에서 관리
- `target_sales_amount`: **최소 기준 매출액** (baseline)
- `target_support_cases`: **최소 기준 처리 건수** (baseline)

### 📋 **새로운 필드 구조**

```php
// 기존 최소 기준치 (컬럼명 유지)
'target_sales_amount'    // 타입별 최소 매출 기준
'target_support_cases'   // 타입별 최소 건수 기준

// 새로운 확장 필드
'min_baseline_revenue'        // 최소 수익 기준
'min_baseline_clients'        // 최소 고객 수 기준
'baseline_quality_score'      // 최소 품질 점수 기준 (0-100)
'performance_weights'         // 성과 평가 가중치 (JSON)
'onboarding_period_months'    // 신규 파트너 적응 기간
'onboarding_target_ratio'     // 신규 파트너 목표 비율 (예: 0.7 = 70%)
```

### 📈 **타입별 최소 기준치 설정**

| 파트너 타입 | 최소 매출 | 최소 건수 | 최소 수익 | 최소 고객수 | 품질 점수 |
|-------------|-----------|-----------|-----------|-------------|-----------|
| **세일즈** | 5,000,000원 | 50건 | 2,000,000원 | 5명 | 80점 |
| **컨설턴트** | 8,000,000원 | 25건 | 4,000,000원 | 3명 | 95점 |
| **마케팅** | 3,000,000원 | 30건 | 1,500,000원 | 8명 | 75점 |
| **기술지원** | 2,000,000원 | 100건 | 800,000원 | 10명 | 90점 |
| **교육** | 1,500,000원 | 80건 | 600,000원 | 15명 | 85점 |
| **고객서비스** | 1,000,000원 | 120건 | 400,000원 | 20명 | 85점 |

---

## 🏆 Partner Tiers (파트너 등급) - 승수 시스템

### 🔢 **새로운 승수 기반 목표 계산**

**핵심 공식:**
```
개인 기본 목표 = 파트너 타입 최소 기준치 × 파트너 등급 승수
```

### 📊 **등급별 승수 테이블**

| 등급 | 매출 승수 | 건수 승수 | 품질 승수 | 고객 승수 | 최소 달성률 | 연속 달성 월수 |
|------|-----------|-----------|-----------|-----------|-------------|---------------|
| **Bronze** | 0.8x | 0.9x | 0.9x | 0.8x | 70% | 1개월 |
| **Silver** | 1.3x | 1.2x | 1.1x | 1.2x | 80% | 2개월 |
| **Gold** | 1.8x | 1.6x | 1.3x | 1.7x | 90% | 2개월 |
| **Platinum** | 2.5x | 2.2x | 1.5x | 2.3x | 100% | 3개월 |

### 🧮 **계산 예시**

**세일즈 파트너 + 골드 등급:**
```
기본 매출 목표 = 5,000,000원 × 1.8 = 9,000,000원
기본 처리 건수 = 50건 × 1.6 = 80건
기본 수익 목표 = 2,000,000원 × 1.8 = 3,600,000원
```

### 🎁 **등급별 혜택 시스템**

```json
// Gold 등급 혜택 예시
{
  "premium_support": true,
  "training_access": ["all"],
  "bonus_multiplier": 1.5,
  "exclusive_events": true,
  "decision_authority": "level_2"
}
```

---

## 🚀 Partner Dynamic Targets (동적 목표) - 개인별 맞춤 시스템

### 🎯 **완전히 새로운 동적 목표 관리**

**핵심 특징:**
- 월별/분기별/연별 **유연한 기간 설정**
- **개인별 조정 계수** 적용으로 맞춤화
- **시장 상황 및 계절성** 반영
- **자동 성과 추적** 및 보너스 계산

### 📅 **기간별 목표 유형**

```php
'monthly'    // 월별 목표 (세밀한 관리)
'quarterly'  // 분기별 목표 (중장기 계획)
'yearly'     // 연별 목표 (장기 성과)
```

### 🔧 **목표 계산 과정**

#### **1단계: 기본 목표 계산**
```
기본 목표 = 타입 최소 기준치 × 등급 승수
```

#### **2단계: 조정 계수 적용**
```php
// 다양한 조정 계수
'personal_adjustment_factor'     // 개인별 조정 (1.0 = 기본, 1.2 = 20% 증가)
'market_condition_factor'        // 시장 상황 (1.5 = 성수기, 0.8 = 비수기)
'seasonal_adjustment_factor'     // 계절성 조정
'team_performance_factor'        // 팀 성과 반영 (리더인 경우)
```

#### **3단계: 최종 목표 산출**
```
최종 목표 = 기본 목표 × 개인 조정 × 시장 조정 × 계절 조정 × 팀 성과 조정
```

### 📊 **실시간 성과 추적**

```php
// 현재 성과 데이터
'current_sales_achievement'      // 현재 매출 달성액
'current_cases_achievement'      // 현재 처리건수 달성
'current_revenue_achievement'    // 현재 수익 달성액
'current_clients_achievement'    // 현재 고객 관리 달성

// 자동 계산되는 달성률
'sales_achievement_rate'         // 매출 달성률 (%)
'cases_achievement_rate'         // 건수 달성률 (%)
'overall_achievement_rate'       // 종합 달성률 (가중평균)
```

### 💰 **보너스 시스템**

#### **달성률별 보너스 설정**
```json
{
  "150": {"rate": 3.0, "description": "초과달성"},
  "120": {"rate": 2.0, "description": "우수달성"},
  "100": {"rate": 1.0, "description": "목표달성"},
  "80":  {"rate": 0.5, "description": "기본달성"}
}
```

#### **보너스 계산**
```
보너스 금액 = 현재 매출 달성액 × (달성률별 보너스율 / 100)
```

### 🔄 **목표 상태 관리**

```php
'draft'             // 초안
'pending_approval'  // 승인대기
'approved'          // 승인완료
'active'            // 활성
'completed'         // 완료
'cancelled'         // 취소
```

---

## 🎛️ 관리 시스템 구조

### 🎯 **PartnerDynamicTarget Controller**

**핵심 기능:**
- **자동 목표 계산**: 타입 기준치 × 등급 승수
- **조정 계수 관리**: 개인/시장/계절성 반영
- **성과 업데이트**: 실시간 달성률 계산
- **보너스 자동 산정**: 설정된 기준에 따른 보너스
- **승인 워크플로**: 초안 → 승인 → 활성화

### 📈 **성과 분석 및 추천**

**PartnerUser ShowController 개선:**
- **목표 달성 추이 분석**: 최근 성과 기반 트렌드 분석
- **다음 목표 추천**: AI 기반 스마트 목표 제안
- **승급 가능성 체크**: 등급 승진 조건 분석

### 📊 **데이터베이스 뷰**

```sql
-- 월별 성과 요약
CREATE VIEW partner_monthly_performance AS ...

-- 팀 성과 요약 (관리자용)
CREATE VIEW partner_team_performance AS ...
```

---

## 🚀 시스템 개선 효과

### ✅ **해결된 문제점**

1. **성장성 한계 극복**
   - ❌ 고정 목표 → ✅ 동적 조정 가능

2. **개인별 맞춤화**
   - ❌ 획일적 목표 → ✅ 개인/시장 상황 반영

3. **역할 명확화**
   - ❌ 타입에서 수수료 관리 → ✅ 순수 기준치 역할
   - ❌ 등급별 고정값 → ✅ 승수 기반 확장
   - ❌ 개인별 설정 혼재 → ✅ 동적 목표 전담

4. **투명한 보너스**
   - ❌ 복잡한 수수료 계산 → ✅ 명확한 달성률 기반 보너스

### 📈 **핵심 이점**

1. **확장성**: 새로운 조정 요소 쉽게 추가
2. **투명성**: 목표 계산 과정 완전 공개
3. **유연성**: 월/분기/연단위 자유로운 목표 설정
4. **자동화**: 성과 추적 및 보너스 자동 계산
5. **예측성**: 다음 목표 스마트 추천

---

## 🔄 마이그레이션 전략

### 📋 **단계별 적용**

1. **1단계**: 기존 데이터 보존하며 새 테이블 생성
2. **2단계**: 파트너 타입에서 수수료 기능 제거
3. **3단계**: 등급별 승수 시스템 적용
4. **4단계**: 동적 목표 시스템 활성화
5. **5단계**: 기존 고정 목표 → 동적 목표 이관

### 🔧 **기술적 구현**

**데이터베이스:**
- 3개 새로운 마이그레이션 파일
- 자동 계산을 위한 데이터베이스 뷰 생성
- 성능 최적화 인덱스 구성

**컨트롤러:**
- PartnerDynamicTargetController (완전 신규)
- PartnerTier/Type/Users 컨트롤러 개선
- 자동 계산 및 추천 로직 구현

**모델:**
- PartnerDynamicTarget 모델 (완전 신규)
- 기존 모델에 관계 추가
- 자동 계산 메서드 구현

---

## 📝 결론

새로운 동적 목표 시스템은 **고정된 목표의 한계를 극복**하고 **개인별 맞춤 성장**을 지원하는 현대적인 파트너 관리 시스템입니다.

**핵심 성과:**
- 🎯 **유연한 목표 관리**: 월/분기/연별 자유로운 설정
- 📊 **투명한 성과 추적**: 실시간 달성률 모니터링
- 💰 **공정한 보상**: 명확한 기준의 보너스 시스템
- 🚀 **지속적 성장**: 개인별 맞춤 목표 추천

이 시스템을 통해 파트너들은 **개인의 역량과 시장 상황에 맞는 최적의 목표**를 가지고 **지속적인 성장**을 이룰 수 있습니다.
