<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * íŒŒíŠ¸ë„ˆ ì•Œë¦¼ ì‹œìŠ¤í…œ í…Œì´ë¸” ìƒì„±
     *
     * =======================================================================
     * ðŸ”” í…Œì´ë¸” ê°œìš”
     * =======================================================================
     * íŒŒíŠ¸ë„ˆë“¤ì—ê²Œ ì „ì†¡ë˜ëŠ” ëª¨ë“  ì•Œë¦¼ì„ í†µí•© ê´€ë¦¬í•˜ëŠ” ë©€í‹°ì±„ë„ ì•Œë¦¼ ì‹œìŠ¤í…œìž…ë‹ˆë‹¤.
     * ì›¹, ì´ë©”ì¼, SMS, í‘¸ì‹œ ë“± ë‹¤ì–‘í•œ ì±„ë„ì„ í†µí•œ ì‹¤ì‹œê°„ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì„ ì§€ì›í•©ë‹ˆë‹¤.
     *
     * =======================================================================
     * ðŸŽ¯ í•µì‹¬ ê¸°ëŠ¥
     * =======================================================================
     * âœ“ ë‹¤ì±„ë„ ì•Œë¦¼ ì „ì†¡ (ì›¹, ì´ë©”ì¼, SMS, í‘¸ì‹œ)
     * âœ“ ì•Œë¦¼ ìš°ì„ ìˆœìœ„ ê´€ë¦¬ (ë‚®ìŒ â†’ ê¸´ê¸‰)
     * âœ“ ì•Œë¦¼ ì½ìŒ ìƒíƒœ ë° ì‹œê°„ ì¶”ì 
     * âœ“ ì•Œë¦¼ ë§Œë£Œ ì‹œê°„ ì„¤ì •
     * âœ“ ì•¡ì…˜ URL ì—°ê²°ë¡œ ë°”ë¡œ ì´ë™ ì§€ì›
     * âœ“ ì±„ë„ë³„ ì „ì†¡ ìƒíƒœ ì¶”ì 
     * âœ“ ê´€ë ¨ ë°ì´í„° ì»¨í…ìŠ¤íŠ¸ ì €ìž¥
     *
     * =======================================================================
     * ðŸ“¨ ì•Œë¦¼ ìœ í˜•
     * =======================================================================
     * â€¢ status_update: íŒŒíŠ¸ë„ˆ ìƒíƒœ ë³€ê²½ ì•Œë¦¼
     * â€¢ interview_scheduled: ë©´ì ‘ ì¼ì • í†µì§€
     * â€¢ approved: íŒŒíŠ¸ë„ˆ ìŠ¹ì¸ ì™„ë£Œ
     * â€¢ rejected: ì‹ ì²­ ê±°ë¶€ í†µì§€
     * â€¢ reapply_available: ìž¬ì‹ ì²­ ê°€ëŠ¥ ì•ˆë‚´
     * â€¢ tier_upgraded: ë“±ê¸‰ ìŠ¹ê¸‰ ì¶•í•˜
     * â€¢ performance_alert: ì„±ê³¼ ê´€ë ¨ ì•Œë¦¼
     *
     * =======================================================================
     * ðŸ“± ì „ì†¡ ì±„ë„
     * =======================================================================
     * â€¢ web: ì›¹ ëŒ€ì‹œë³´ë“œ ë‚´ ì•Œë¦¼
     * â€¢ email: ì´ë©”ì¼ ì „ì†¡
     * â€¢ sms: SMS ë¬¸ìž ë°œì†¡
     * â€¢ push: ëª¨ë°”ì¼ í‘¸ì‹œ ì•Œë¦¼
     *
     * =======================================================================
     * âš¡ ìš°ì„ ìˆœìœ„ ì²´ê³„
     * =======================================================================
     * â€¢ low: ì¼ë°˜ ì •ë³´ (ì„±ê³¼ ë¦¬í¬íŠ¸ ë“±)
     * â€¢ normal: í‘œì¤€ ì•Œë¦¼ (ìƒíƒœ ë³€ê²½)
     * â€¢ high: ì¤‘ìš” ì•Œë¦¼ (ë©´ì ‘ ì¼ì •)
     * â€¢ urgent: ê¸´ê¸‰ ì•Œë¦¼ (ìŠ¹ì¸/ê±°ë¶€)
     *
     * =======================================================================
     * ðŸ”— í…Œì´ë¸” ê´€ê³„
     * =======================================================================
     * â€¢ users â†’ partner_notifications (1:N) : ìˆ˜ì‹ ìžë³„ ì•Œë¦¼
     * â€¢ partner_users â†’ partner_notifications (1:N) : íŒŒíŠ¸ë„ˆë³„ ì•Œë¦¼
     *
     * =======================================================================
     * ðŸ“ˆ ì„±ëŠ¥ ìµœì í™”
     * =======================================================================
     * â€¢ ìˆ˜ì‹ ìžë³„ ì½ìŒìƒíƒœ ë³µí•© ì¸ë±ìŠ¤
     * â€¢ ì•Œë¦¼ ìœ í˜•ë³„ ì¡°íšŒ ìµœì í™”
     * â€¢ ìš°ì„ ìˆœìœ„ë³„ ì •ë ¬ ì¸ë±ìŠ¤
     * â€¢ ë§Œë£Œë˜ì§€ ì•Šì€ ì•Œë¦¼ ë¹ ë¥¸ ì¡°íšŒ
     */
    public function up(): void
    {
        Schema::create('partner_notifications', function (Blueprint $table) {
            $table->id();
            $table->timestamps();

            // ìˆ˜ì‹ ìž ì •ë³´
            $table->unsignedBigInteger('user_id')->comment('ìˆ˜ì‹ ìž ì‚¬ìš©ìž ID');
            $table->string('user_uuid')->nullable()->comment('ìˆ˜ì‹ ìž UUID');

            // ì•Œë¦¼ ì •ë³´
            $table->string('title', 200)->comment('ì•Œë¦¼ ì œëª©');
            $table->text('message')->comment('ì•Œë¦¼ ë‚´ìš©');
            $table->string('type', 50)->comment('ì•Œë¦¼ ìœ í˜•');
            // ì•Œë¦¼ ìœ í˜•: status_update, interview_scheduled, approved, rejected,
            // reapply_available, tier_upgraded, performance_alert

            $table->string('priority', 20)->default('normal')->comment('ìš°ì„ ìˆœìœ„');
            // ìš°ì„ ìˆœìœ„: low, normal, high, urgent

            // ê´€ë ¨ ë°ì´í„°
            $table->json('data')->nullable()->comment('ê´€ë ¨ ë°ì´í„°');
            $table->string('action_url', 500)->nullable()->comment('ì•¡ì…˜ URL');

            // ìƒíƒœ ê´€ë¦¬
            $table->boolean('is_read')->default(false)->comment('ì½ìŒ ì—¬ë¶€');
            $table->timestamp('read_at')->nullable()->comment('ì½ì€ ì‹œê°„');
            $table->timestamp('expires_at')->nullable()->comment('ë§Œë£Œ ì‹œê°„');

            // ì „ì†¡ ì±„ë„
            $table->json('channels')->default('[]')->comment('ì „ì†¡ ì±„ë„');
            // ì±„ë„: ['web', 'email', 'sms', 'push']

            $table->json('delivery_status')->nullable()->comment('ì „ì†¡ ìƒíƒœ');
            // {
            //   "web": {"status": "delivered", "delivered_at": "2025-11-09 10:00:00"},
            //   "email": {"status": "sent", "sent_at": "2025-11-09 10:01:00"}
            // }

            // ì¸ë±ìŠ¤
            $table->index(['user_uuid', 'is_read', 'created_at']);
            $table->index(['type', 'created_at']);
            $table->index(['priority', 'is_read']);
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('partner_notifications');
    }
};